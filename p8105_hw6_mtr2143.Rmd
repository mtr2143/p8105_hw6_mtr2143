---
title: "Homework 6"
author: Matthew T. Russell
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(modelr)
library(knitr)

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

knitr::opts_chunk$set(
  message = FALSE, 
  warning = FALSE
)
```

# Problem 1

```{r, read in birthweight data and see if there are any NA values}
birthweight_data <- read_csv("https://www.p8105.com/data/birthweight.csv")

birthweight_missing <- map_df(birthweight_data, ~sum(is.na(.))) %>% 
  pivot_longer(
    cols = babysex:wtgain,
    names_to = "variable", 
    values_to = "num_missing"
  )

birthweight_missing %>% kable()
```

From the table above, we can see that none of the variables contain any NA values. 

```{r, see if frace variable has any unknown}
birthweight_data %>% 
  group_by(frace) %>% 
  summarize(
    total = n()
  ) %>% 
  kable()
```

Per the data description, we know that the variable correspond to the father's race has a value for observations where the value is unknown (`frace == 9`), However, from the table above, we can see that there aren't any observations that have this value. 

Now that we know there aren't any missing values, we can fit a model. 

```{r, tidying birthweight data}
birthweight_df <-
  birthweight_data %>% 
  mutate(
    babysex = ifelse(babysex == 1, "male", "female") %>% 
      forcats::as_factor() %>% 
      relevel(ref = "male"),
    frace = case_when(
      frace == 1 ~ "white", 
      frace == 2 ~ "black", 
      frace == 3 ~ "asian", 
      frace == 4 ~ "puerto rican", 
      frace == 8 ~ "other"
    ) %>% 
      forcats::as_factor() %>% 
      relevel(ref = "other"),
    malform = ifelse(malform == 0, "absent", "present") %>% 
      forcats::as_factor() %>% 
      relevel(ref = "absent"), 
    mrace = case_when(
      mrace == 1 ~ "white", 
      mrace == 2 ~ "black", 
      mrace == 3 ~ "asian", 
      mrace == 4 ~ "puerto rican"
    ) %>% 
      forcats::as_factor() %>% 
      relevel(ref = "puerto rican")
  )
```

```{r, regression model}
bwt_fit <- lm(bwt ~ fincome + frace + gaweeks + mrace + momage + smoken, data = birthweight_df)

bwt_fit %>% 
  broom::tidy() %>% 
  select(term, estimate, p.value) %>% 
  mutate(
    term = str_replace(term, "^frace", "frace: "), 
    term = str_replace(term, "^mrace", "mrace: ")
  ) %>% 
  knitr::kable(digits = 3)
```

I chose to run a model where baby's birthweight (g) is predicted by family income, father's race, gestational age at delivery (weeks), mother's race, mother's age at delivery (years), and average number of cigarettes smoked per day during pregnancy. The goal of this model was to predict birthweight based on known biological factors that influence birthweight (gestational age and number of cigarettes smoked during pregnancy) with social factor (family income and father and mother's race). 

```{r, regression diagnostics}

```

